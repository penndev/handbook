
# MPEG2-TS 分析工具

> mpegts使用了3层封装（ES > PES > TS）数据。通常我们看到的文件都是若干个 188个以 0x47开头的 ts packet 组成的。如果我们需要拆包es 需要从上到下逐层拆包结构。如果需要封包则刚好相反。

## TS
> 每个 ts packet 由188个字节组成， 这些字节通常为3部分，文件头，适配字段（可能不存在），载荷。因为ts是对pes数据进行封装。通常来说pes的数据肯定是大于188的，这样就有多个ts packet 来进行包含pes数据。


### TS  Header
> 4个字节 32位数据包含了8个字段 

示例数据 `47 41 00 30`

`01000111 01000001 00000000 00110000`

`01000111 0 1 0 0000100000000 00 11 0000`


| 位数 | 描述 |
|------|------|
| 8 | 固定的数据0x47 |
| 1 | 发送时（调制前）值为0。接收方的解调器在无法成功解调（即使有前向纠错机制）TS分组内容时，将该位设置为1，表示该TS分组损坏 |
| 1 | 负载单元起始标示符，一个完整的数据包开始时标记为1, 表示携带的是PSI或PES第一个包 |
| 1 | 值为1时，在相同PID的分组中具有更高的优先权。|
| 13 | PID用于识别TS分组的ID。一个PID对应一种特定的PSI消息或者一个特定的PES。|
|2| 值为'00'时表示载荷未加密。其余值由具体系统定义。 |
| 2 | 适配域表示 '00' = 保留 (供未来使用) '01' = 无适配域，仅有载荷 '10' = 仅有适配域 '11' = 适配域和载荷都存在
| 4 | 取值为0x00到0x0F，循环。用于检查同一个PID的TS分组的连续性。每当一个TS分组中包含载荷时，该计数器加1。

### TS Adaptation (可以不存在)

> 这个结构体只有在 ts header 适配域 位 `10` `11` 时候存在。

### TS Payload (可以不存在)

> 这个结构体只有在 ts header 适配域 位 `01` `11` 时候存在。