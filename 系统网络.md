# Linux 网络学习笔记

## OSI 七层模型
>  Open System Interconnection Model（开放式系统互联模型 缩写：OSI；简称为OSI模型）由国际标准化组织提出的概念模型，一个试图使各种计算机在世界范围内互连为网络的标准框架。定义于ISO/IEC 7498-1。

| 层级 | 名称 |  说明 |
| -- | -- |  -- |
| **1** | 物理层 |   机械，电子，定时接口通信信道上的原始的比特流传输。 |
| **2** | 链路层 |  物理寻址，同时将原始的比特流进行逻辑编码 |
| **3** | 网络层 | IP寻址，在网络间查找最佳路径|

### 1.物理层 
> 物理层为互联网基础，所有数据传输都是通过物理层设备或材料进行数据传输。 生活中的常见物理层设备或材料：网卡，猫，光纤，网线(电缆)，WI-FI(无线电)。   
    **Ethernet（IEEE 802.3）**：最常见的网卡标准，用于局域网 (LAN) 中。  
    **Wi-Fi (IEEE 802.11)**：无线网络标准，用于无线局域网 (WLAN) 中。  
    **Bluetooth (IEEE 802.15.1)**：近距离无线通信标准，用于连接移动设备和周边设备。  
    ~~**Fibre Channel (FC)**：高速数据传输标准，用于存储网络 (SAN) 中。~~  
    ~~**InfiniBand**:主要应用于高性能集群和大规模计算环境中。~~  
    ...包括手机通讯中的2G(GSM) 3G（CDMA ）4G（LTE）5G(NR)  
    *理解像是把（电报机）或者（远程信号指示灯）。能进行材料限制以内的基础的1对1，或者1对多的数据或信息传输。*

### 2. 链路层
> 在计算机物理网络中由于各种干扰的存在，物理链路是不可靠的。因此，这一层的主要功能是在物理层提供的比特流的基础上，通过差错控制、流量控制方法，使有差错的物理线路变为无差错的数据链路，即提供可靠的通过物理介质传输数据的方法。数据链路层的具体工作是接收来自物理层的位流形式的数据，并封装成帧，传送到上一层；同样，也将来自上层的数据帧，拆装为位流形式的数据转发到物理层；并且，还负责处理接收端发回的确认帧的信息。
#### 介质访问控制（MAC）
> MAC子层的主要任务是解决共享型网络中多用户对信道竞争的问题，完成网络介质的访问控制
#### 逻辑链路控制（LLC）
>LLC子层的主要任务是建立和维护网络连接，执行差错校验、流量控制和链路控制


### 3. 网络层
> 网络层 负责网络管理和路由。它的主要作用是在网络中传输数据包并确定最佳路径。网络层主要使用的协议是  
    **Internet Control Message Protocol(ICMP)** 
    **Internet Protocol (IP)**  
    **子网**  
    **路由**  
    **网关**  
    **掩码**  

#### NAT
>网络地址转换(Network Address Translation) 是一种网络地址转换技术，它可以将内部网络的 IP 地址转换为公共 IP 地址。  

##### 地址转换 (Address Translation)
地址转换是指将内部网络的 IP 地址转换为公共 IP 地址。在这种方式下，内部网络的设备都共享一个公共 IP 地址，发送到外部网络的数据包会被路由器转换为公共 IP 地址发送出去。

##### 隧道(Tunneling)
隧道是指将整个 IP 数据报封装在另一个 IP 数据报中，并将其发送到目的地。在这种方式下，内部网络的设备都有自己的公共 IP 地址，发送到外部网络的数据包会被封装在另一个 IP 数据报中发送出去。

## 网络设备

### 物理网卡

...

**以太网虚拟网卡设备,虚拟网卡上网需要将Linux设置为“路由器模式”启用IP转发并配置NAT规则，才能通过物理网口进行出网。**

### tap虚拟设备
tap设备位于OSI模型的第二层。
### tun虚拟设备
>tun设备位于OSI模型的第三层。
```bash
#查看网络设备
ip link show

#增加tun设备
ip tuntap add dev tun0 mode tun

#删除tun设备
ip link del tun0

#启用TUN设备
ip link set dev tun0 up

#关闭设备
ip link set tun0 down

#分配IP
ip addr add 10.0.0.1/24 dev tun0

#设置路由 
ip route add 10.0.0.0/24 dev tun0
```

## iptables
> iptables 是 Linux 内核中的一个防火墙管理工具。它可以用来控制网络数据包的流动，并对数据包进行过滤、转发、转换等操作。其他的Linux防火墙工具都是基于iptables之上的封装。


### NAT表 
- 开启IP转发功能

    `echo 1 > /proc/sys/net/ipv4/ip_forward`

- 将 `10.0.0.0/8` 的流量都通过`eth0`进行NAT转换进行出网

    `iptables -t nat -A POSTROUTING -s 10.0.0.0/8 -o eth0 -j MASQUERADE`