# Linux 网络学习笔记

## 名词

- WAN 广域网
- LAN 局域网
- Byte 字节单位 1byte=8bit
- BPS  每秒传输单位 1bit/s
- 信道
    - 单工
    - 半双工
    - 全双工

#### NAT
>网络地址转换(Network Address Translation) 是一种网络地址转换技术，它可以将内部网络的 IP 地址转换为公共 IP 地址。  

##### 地址转换 (Address Translation)
地址转换是指将内部网络的 IP 地址转换为公共 IP 地址。在这种方式下，内部网络的设备都共享一个公共 IP 地址，发送到外部网络的数据包会被路由器转换为公共 IP 地址发送出去。

##### 隧道(Tunneling)
隧道是指将整个 IP 数据报封装在另一个 IP 数据报中，并将其发送到目的地。在这种方式下，内部网络的设备都有自己的公共 IP 地址，发送到外部网络的数据包会被封装在另一个 IP 数据报中发送出去。

## 网络设备

### 物理网卡

...

**以太网虚拟网卡设备,虚拟网卡上网需要将Linux设置为“路由器模式”启用IP转发并配置NAT规则，才能通过物理网口进行出网。**

### tap虚拟设备
tap设备位于OSI模型的第二层。
### tun虚拟设备
>tun设备位于OSI模型的第三层。
```bash
#查看网络设备
ip link show

#增加tun设备
ip tuntap add dev tun0 mode tun

#删除tun设备
ip link del tun0

#启用TUN设备
ip link set dev tun0 up

#关闭设备
ip link set tun0 down

#分配IP
ip addr add 10.0.0.1/24 dev tun0

#设置路由 
ip route add 10.0.0.0/24 dev tun0
```

## iptables
> iptables 是 Linux 内核中的一个防火墙管理工具。它可以用来控制网络数据包的流动，并对数据包进行过滤、转发、转换等操作。其他的Linux防火墙工具都是基于iptables之上的封装。

### 查看放开的端口
```shell
iptables -L -n
```

### 放行与删除端口
> 放行后需要进行保存，不然重启后会丢失操作
```shell
iptables -A INPUT -p <protocol> --dport <port> -j ACCEPT

iptables -D INPUT -p <protocol> --dport <port> -j ACCEPT
```


### NAT表 
- 开启IP转发功能

    `echo 1 > /proc/sys/net/ipv4/ip_forward`

- 将 `10.0.0.0/8` 的流量都通过`eth0`进行NAT转换进行出网

    `iptables -t nat -A POSTROUTING -s 10.0.0.0/8 -o eth0 -j MASQUERADE`

